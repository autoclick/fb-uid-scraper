---
title: "Fb_downloadWatchingVideo.Js"
date: "2023-11-23"
categories: 
  - "useful-script-en"
---

how to add bookmarklet in chrome  
![](https://camo.githubusercontent.com/5f21e427a7d3ee887313a4f9b1ab033e6462db47ca299bf3f7e2d81a0ce854bd/68747470733a2f2f696d672e7765626e6f74732e636f6d2f323031392f30342f447261672d616e642d44726f702d4c696e6b732d696e2d4368726f6d652e706e67)`import { runScriptInCurrentTab, showLoading } from “./helpers/utils.js”; import { shared as fb_videoDownloader } from “./fb_videoDownloader.js”;  export default { icon: “https://www.facebook.com/favicon.ico”, name: { en: “Download watching fb video”, vi: “Tải video fb đang xem”, }, description: { en: “Download any facebook video that you are watching (watch/story/comment/reel/chat)”, vi: “Tải bất kỳ video facebook nào mà bạn đang xem (watch/story/comment/reel/chat/bình luận/tin nhắn)”, }, whiteList: [“https://www.facebook.com/*”],  onClickExtension: async function () { let { closeLoading, setLoadingText } = showLoading( “Đang lấy videoId từ trang web…” ); try { let listVideoId = await shared.getListVideoIdInWebsite(); let watchingVideoId = listVideoId[0]; if (!watchingVideoId) throw Error(“Không tìm thấy video nào”);  setLoadingText(“Đang lấy token dtsg…”); let dtsg = await fb_videoDownloader.getDtsg();  setLoadingText(“Đang tìm video url…”); let videoUrl = await fb_videoDownloader.getLinkFbVideo( watchingVideoId, dtsg );  if (videoUrl) { UsefulScriptGlobalPageContext.Utils.downloadURL( videoUrl, “fb_video.mp4” ); } else throw Error(“Không tìm được video link”); } catch (e) { alert(“ERROR: ” + e); } finally { closeLoading(); } }, };  export const shared = { getListVideoIdInWebsite: async function () { return await runScriptInCurrentTab(() => { const { getOverlapScore } = UsefulScriptGlobalPageContext.DOM;  let allVideos = Array.from(document.querySelectorAll(“video”)); let result = []; for (let video of allVideos) { try { let key = “”; for (let k in video.parentElement) { if (k.startsWith(“__reactProps”)) { key = k; break; } } result.push({ overlapScore: getOverlapScore(video), videoId: video.parentElement[key].children.props.videoFBID, }); } catch (e) { console.log(“ERROR on get videoFBID: “, e); } }  return result .sort((a, b) => b.overlapScore – a.overlapScore) .map((_) => _.videoId); }); }, };`
