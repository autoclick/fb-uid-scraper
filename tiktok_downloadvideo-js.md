---
title: "Tiktok_downloadVideo.Js"
date: "2023-11-23"
categories: 
  - "useful-script-en"
---

how to add bookmarklet in chrome  
![](https://camo.githubusercontent.com/5f21e427a7d3ee887313a4f9b1ab033e6462db47ca299bf3f7e2d81a0ce854bd/68747470733a2f2f696d672e7765626e6f74732e636f6d2f323031392f30342f447261672d616e642d44726f702d4c696e6b732d696e2d4368726f6d652e706e67)`import { runScriptInCurrentTab, showLoading } from "./helpers/utils.js"; import { shared as tiktok_downloadWatchingVideo } from "./tiktok_downloadWatchingVideo.js";  export default { icon: "https://www.tiktok.com/favicon.ico", name: { en: "Tiktok – Download video (API)", vi: "Tiktok – Download video (API)", }, description: {  en: "Download tiktok video from url (no/have watermark)", vi: "Download tiktok video from link (no/have watermark)",  },  onClickExtension: async function() { let url = prompt( "Enter tiktok video link: ", await runScriptInCurrentTab(() => location.href) ); if (url == null) return;  let watermark = prompt("Get video watermark?\n 0:No\n 1:Yes", 0);  let { closeLoading } = showLoading( "Taking video link without watermark... " ); try { let link = ""; if (watermark == "0") { link = await shared.getVideoNoWaterMark(url); if (link) window.open(link); else throw Error("Video could not be found, no watermark"); } else { link = await shared.getVideoWaterMark(url); if (link) await tiktok_downloadWatchingVideo.renderVideoInWeb( link); else throw Error("Video could not be found, no watermark");  }  } catch (e) { alert("ERROR: " + e); } finally { closeLoading(); } }, };  export const shared = { // Source code: https://github.com/karim0sec/tiktokdl getVideoId: function (url) { if (url.includes("@") && url.includes("/video/")) return url.split("/video /") [1].split("?") [0]; throw Error("TikTok video URL is not properly formatted"); },  getVideoNoWaterMark: async function(video_url, isVideoId = false) { let videoId = isVideoId ? video_url : shared.getVideoId(video_url); if (!videoId) throw Error("Video URL is not properly formatted");  let API_URL = 'https://api19-core-useast5.us.tiktokv.com/aweme/v1/feed/?aweme_id=${videoId}&version_code=262&app_name=musical_ly&channel=App&device_id=null&os_version=14.4.2&device_platform=iphone&device_type=iPhone9'; let request = await fetch(API_URL, { method: "GET", headers: { "Content-Type": "application/json",  "User-Agent": "TikTok 26.2.0 rv: 262018 (iPhone; iOS 14.4.2; en_US) Cronet", }, }); let res = await request.json(); console.log(res); let url = res.aweme_list[0].video.play_addr.url_list[0]; return URL; },  https://github.com/soimort/you-get/blob/develop/src/you_get/extractors/tiktok.py getVideoWaterMark: async function(video_url) { // let res = await openWebAndRunScript({ // video_url, // closeAfterRunScript: true, // focusAfterRunScript: false,  // func: () => { /  / return window. SIGI_STATE; // }, // });  let res = await fetch(video_url); let html = await res.text();  prettier-ignore let data = new RegExp('window\[\'SIGI_STATE\'\]=(.*?); window\[\'SIGI_RETRY\'\]').exec(html)?. [1] || new RegExp('').exec(html)?. [1]; let json = JSON.parse(data); let vid = Object.keys(json. ItemModule)?. [0]; let vdata = json. ItemModule[vid];  let url = vdata?. Video?. downloadAddr || vdata?. Video?. playAddr; let author = vdata?. author; let nickname = json?. UserModule?. users?. author?. nickname;  return { URL, author, nickname }; return URL; }, };`
