---
title: "Transfer_sh.Js"
date: "2023-11-23"
categories: 
  - "useful-script-en"
---

how to add bookmarklet in chrome  
![](https://camo.githubusercontent.com/5f21e427a7d3ee887313a4f9b1ab033e6462db47ca299bf3f7e2d81a0ce854bd/68747470733a2f2f696d672e7765626e6f74732e636f6d2f323031392f30342f447261672d616e642d44726f702d4c696e6b732d696e2d4368726f6d652e706e67)``export default { icon: "https://transfer.sh/favicon.ico", name: { en: "Transfer.sh – Share file faster", vi: "Transfer.sh – Share files quickly", }, description: {  en: "Upload file and get URL to share", vi: "Upload file and get link to share",  },  onClickExtension: function() { / / https://transfer.sh  x-url-delete: https://transfer.sh/xtRy1u/Screenshot%20%281%29.png/Fpg96TDmuH5x  https://stackoverflow.com/a/52757538/11898496 function selectFile(contentType, multiple) { return new Promise((resolve) => { let input = document.createElement("input"); input.type = "file";  input.multiple = multiple; if (contentType) input.accept = contentType;  input.onchange = (_) => { let files = Array.from(input.files); if (multiple) resolve(files); else resolve(files[0]);  };  input.click(); }); }  https://stackoverflow.com/a/69400632/11898496 function uploadFileWithProgress(url, file, onProgress) { const xhr = new XMLHttpRequest(); return { cancel: xhr.abort, startUpload: () => new Promise((resolve) => { xhr.upload.addEventListener("progress", (event) => { if (event.lengthComputable) { let { loaded, total } = event; let percent = loaded / total;  onProgress?. ({ percent, loaded, total }); } }); xhr.onreadystatechange = () => { if (xhr.readyState === xhr. HEADERS_RECEIVED) { const urlDelete = xhr.getResponseHeader("x-url-delete"); resolve(urlDelete);  } }; xhr.open("PUT", url, true); xhr.send(file); }), }; }  //  //  OR  // Open transfer.sh in a new tab  (async () => { let html = '  `;  let div = document.createElement("div"); div.innerHTML = html; document.body.appendChild(div);  const containerDiv = document.querySelector(".transfer-sh-container"); const status = containerDiv.querySelector(".status"); const fileInfo = containerDiv.querySelector(".file-info"); const progressDiv = containerDiv.querySelector("progress"); const loader = containerDiv.querySelector(".loader"); const resultDiv = containerDiv.querySelector(".result"); const closeBtn = containerDiv.querySelector("#close-btn");  closeBtn.addEventListener("click", function() { div.remove(); });  containerDiv.style.display = "flex"; // return;  let file = await selectFile(); console.log(file);  if (file) { let url = "https://transfer.sh/" + file.name; let { startUpload, cancel } = uploadFileWithProgress( url, file, ({ percent, loaded,  total }) => { progressDiv.value = percent * 100;  let uploadDone = percent == 1; status.innerText = uploadDone ? 'Creating link...' : 'Uploading...' ;  let kb = uploadDone ? ~~(file.size / 1e3) + "Kb" : '${~~(loaded / 1e3)}/${~~(total / 1e3)}Kb'; fileInfo.innerText = '${file.name}\n(${kb})'; } );  fileInfo.innerText = '${file.name}\n(${~~(file.size / 1e3)}Kb)'; containerDiv.style.display = "flex"; loader.style.display = "block"; closeBtn.addEventListener("click", cancel);  let urlDelete = await startUpload(); status.innerText = 'Upload complete'; loader.style.display = "none";  if (urlDelete) { let url = urlDelete.slice(0, urlDelete.lastIndexOf("/")); let deletionToken = urlDelete.slice(urlDelete.lastIndexOf("/") + 1);  let downloadZipUrl = url + ".zip"; let downloadTarGzUrl = url + ".tar.gz";  resultDiv.innerHTML = '  URL: Delete token:  Download .zip Download .tar.gz  `; } else { alert( “Lỗi\n\nBạn có thể mở trang web sau để upload file:”, “https://transfer.sh/” ); } } })(); }, };  function backup() { function uploadFile(url, file) { fetch(url, { method: “PUT”, body: file, }) .then((res) => { console.log(res); console.log(res.headers.get(“x-url-delete”));  alert(“sucecss”); }) .catch((e) => { alert(“ERROR ” + e); }); } }``
