---
title: "Shopee_topVariation.Js"
date: "2023-11-23"
categories: 
  - "useful-script-en"
---

how to add bookmarklet in chrome  
![](https://camo.githubusercontent.com/5f21e427a7d3ee887313a4f9b1ab033e6462db47ca299bf3f7e2d81a0ce854bd/68747470733a2f2f696d672e7765626e6f74732e636f6d2f323031392f30342f447261672d616e642d44726f702d4c696e6b732d696e2d4368726f6d652e706e67)``import { getTableStyle } from "./helpers/predefined_css.js"; import { getCurrentTab, openPopupWithHtml, showLoading,  } from "./helpers/utils.js";  export default { icon: "https://shopee.vn/favicon.ico", name: { en: "Shopee – Top variation", vi: "Shopee – Most purchased category", }, description: {  en: "See how many times each product variant was purchased", vi: "Statistics on which product options people buy the most",  }, whiteList: ["https://shopee.vn/*"],  onClickExtension: async function() { // Source: https://gist.github.com/J2TEAM/bc5d9a1f3e648d6a3d679edf8689e5de /  / Post: https://www.facebook.com/groups/j2team.community/posts/1730753827256730/  let { setLoadingText, closeLoading } = showLoading("Preparing..."); try { var helpers = { scope: {}, createTemplateTagFirstArg: function (a) { return (a.raw = a); }, createTemplateTagFirstArgRaw: function (a, d) { a.raw = d; return a; },  arrayIteratorImpl: function ( a) {  var d = 0;  return function () { return d < a.length ? { done: !1, value: a[d++] } : { done: !0 }; }; }, arrayIterator: function (a) { return { next: helpers.arrayIteratorImpl(a) }; }, makeIterator: function (a) { var d = "undefined" != typeof Symbol && Symbol.iterator && a[Symbol.iterator]; return d ? d.call(a) : helpers.arrayIterator(a); }, }; function a(arr) { arr.forEach(function (c) { c.product_items && c.product_items.forEach(function (i) { count[i.model_name] ? count[i.model_name]++ : (count[i.model_name] = 1); }); }); } function d() { var b = Object.fromEntries( Object.entries(count).sort(function(c, e) { var g = helpers.makeIterator(c); g.next(); g = g.next().value; var m = helpers.makeIterator(e); m.next(); return m.next().value - g; }) ); console.info("Done. Result:"); console.table(b); showResult(b); } async function run() { var url = "https://shopee.vn/api/v2/item/get_ratings?filter=0&flag=1&itemid=" + itemId + "&limit=50&offset=" + Offset + "&shopid=" + shopId+ "&type=0"; setLoadingText(title + " Scanning page " + page + "..."); let res = await fetch(URL, { headers: { "x-api-source": "pc", "x-requested-with": "XMLHttpRequest", "X-shopee-language": "en", }, method: "GET", mode: "cors", credentials: "include", }); let json = await res.json(); console.log(JSON); json.error || !json.data || !json.data.ratings?. length ? 1 < page &&; d() : (a(json.data.ratings), 50 > page ? ((offset += 50), page++, await run()) : d()); } function showResult(data) { let html = Object.entries(data) .map(([key, value], index) => { return '  ${index} ${key} ${value}  `; }) .join("");  openPopupWithHtml( `  Product Link  ${html}  # Kind Purchases  ', 500,  window.screen.height ); }  var count = {}, offset = 0, page = 1, shopId = null, itemId = null,  title = "";  setLoadingText("Website url fetching..."); let tab = await getCurrentTab(); var b = new URL(tab.url); if (!b.hostname.includes("shopee.vn")) throw Error("This code can only be used on web Shopee.vn"); if ((b = /.+-i\.( [0-9]+). ([0-9]+)/.exec(b.pathname))) (shopId = b[1]), (itemId = b[2]); else throw Error( "The page you are viewing is not a Shopee product page." );  title = "Start analysis with " + 'Shop ID: ${shopId}' + 'Product code: ${itemId}  '  + "...  ";  await run(); } catch (e) { alert("ERROR: " + e); } finally { closeLoading(); } }, };``
