---
title: "Tiki_totalSpendMoney.Js"
date: "2023-11-23"
categories: 
  - "useful-script-en"
---

how to add bookmarklet in chrome  
![](https://camo.githubusercontent.com/5f21e427a7d3ee887313a4f9b1ab033e6462db47ca299bf3f7e2d81a0ce854bd/68747470733a2f2f696d672e7765626e6f74732e636f6d2f323031392f30342f447261672d616e642d44726f702d4c696e6b732d696e2d4368726f6d652e706e67)`import { showLoading } from "./helpers/utils.js";  export default { icon: "https://tiki.vn/favicon.ico", name: { en: "Tiki – Total spend money?", vi: "Tiki – How much money did you buy?", }, description: { en: "See how much money you have spent on Tiki",  en: "See how much money you have bought on Tiki",  }, whiteList: ["https://tiki.vn/*"],  onClickExtension: async () => { / / https://www.facebook.com/groups/j2team.community/permalink/1169967376668714/  const { moneyFormat } = UsefulScriptGlobalPageContext.Utils;  const OrderType = { all: "", awaiting_payment: "awaiting_payment", processing: "processing", shipping: "shipping", completed: "completed", canceled: "canceled",  };  const OrderTypeName = { [OrderType.completed]: "Delivered", [OrderType.canceled]: "Cancelled", [OrderType.shipping]: "In transit", [OrderType.processing]: "Processing", [OrderType.awaiting_payment]: "Pending payment", [OrderType.all]: "All",  };  https://tiki.vn/api/v2/orders?page=0&limit=10&status=canceled async function getStatistics(orderType) { let pulling = true; let page = 0; let limit = 10;  let totalDiscount = 0; let totalShip = 0; let totalSpent = 0; let totalItems = 0; let totalOrders = 0;  while (pulling) { setLoadingText("Loading th page" + (page + 1) + "..."); let res = await fetch( 'https://tiki.vn/api/v2/orders?page=${page}&limit=${limit}${ orderType ? "&status=" + orderType : "" }' ); let json = await res.json(); if (json?. error) throw json.error;  let orders = json.data; totalOrders += orders.length; for (let i = 0; i < orders.length; i++) { setLoadingText( "Loading th order" + (page * limit + i + 1) + "..." ); let order = orders[i]; let detail = await getOrderDetail(order.id); totalSpent += order.grand_total; totalItems += detail.items.reduce((total, cur) => total + cur.qty, 0); totalDiscount += detail.discount_amount; totalShip += detail.shipping_amount; }  pulling = orders.length >= limit; page++; }  return { totalDiscount, totalShip, totalSpent, totalItems, totalOrders,  }; }  async function getOrderDetail(orderId) { let res = await fetch( 'https://tiki.vn/api/v2/me/orders/${orderId}?include=items ' ); return await res.json();  }  let { closeLoading, setLoadingText } = showLoading("Preparing..."); try { let options = Object.entries(OrderTypeName); let optionsTxt = options .map(([key, value], index) => ' ${index}: ${value}') .join("\n");  let choice = prompt( "Select order type want statistics:\n " + optionsTxt, 0 );  if (choice == null) return; let orderType = options[Number(choice)][0]; let orderTypeName = OrderTypeName[orderType];  let { totalDiscount, totalShip, totalSpent, totalItems, totalOrders } = await getStatistics(orderType);  let stats = { "Tiki STATISTICS: Orders": orderTypeName, "+ Total Orders: ": totalOrders, "+ Total Products: ": totalItems,  "+ Total Spend: ": moneyFormat(totalSpent), "+ Total Discount: ": moneyFormat(totalDiscount), "+ Total Ship: ": moneyFormat(totalShip),  }; alert( Object.entries(stats) .map(([key, value]) => '${key} ${value}')  .join("\n") ); console.table(stats); } catch (e) { console.log(e); alert("ERROR: " + e.message);  } finally { closeLoading(); } }, };`
