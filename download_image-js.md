---
title: "Download_image.Js"
date: "2023-11-23"
categories: 
  - "useful-script-en"
---

how to add bookmarklet in chrome  
![](https://camo.githubusercontent.com/5f21e427a7d3ee887313a4f9b1ab033e6462db47ca299bf3f7e2d81a0ce854bd/68747470733a2f2f696d672e7765626e6f74732e636f6d2f323031392f30342f447261672d616e642d44726f702d4c696e6b732d696e2d4368726f6d652e706e67)``export default { icon: "https://lh3.googleusercontent.com/_8e79Pwdo6TDVUifSMzqFdRKQ-ecpFX_75hj2147LyRGKTHNtuL_yeT4ar72SzECS7gfItTFumowOAsxKfKGqaAS21k=w128-h128-e365-rj-sc0x00ffffff", name: { en: "Image Downloader", vi: "Image Downloader", }, description: {  en: "Download all images in viewport", en: "Download all images in viewport",  },  onClick: function() { // images downloader: https://chrome.google.com/webstore/detail/image-downloader/cnpniohnfphhjihaiiggeabnkjhpaldj const imageUrlRegex = /(?:([^:\/?#]+):)?(?:\/\/([^\  /?#]*))?( [^?#]*\. (?:bmp|gif|ico|jfif|jpe?g|png|svg|tiff?|webp))(?:\?( [^#]*))? (?:#(.*))?/i; function extractImagesFromSelector(selector, onlyInViewport = false) { return unique( toArray(document.querySelectorAll(selector)) .filter((_) => onlyInViewport ? isElementIntersectViewport(_) : true ) .map(extractImageFromElement) .filter(isTruthy) .map(relativeUrlToAbsolute)  ); } function extractImageFromElement(element) { if (element.tagName.toLowerCase() === "img") { const src = element.src; const hashIndex = src.indexOf("#"); return hashIndex >= 0 ? src.substr(0, hashIndex) : src;  } if (element.tagName.toLowerCase() === "image") { const src = element.getAttribute("xlink:href"); const hashIndex = src.indexOf("#");  return hashIndex >= 0 ? src.substr(0, hashIndex) : src; } if (element.tagName.toLowerCase() === "a") { const href = element.href; if (isImageURL(href)) { return href;  } } const backgroundImage = window.getComputedStyle(element).backgroundImage; if (backgroundImage) { const parsedURL = extractURLFromStyle(backgroundImage); if (isImageURL(parsedURL)) { return parsedURL; } } } function isElementIntersectViewport(el) { var rect = el.getBoundingClientRect(); //prettier-ignore return !( rect.bottom < 0 || rect.right < 0 || rect.top > (window.innerHeight || document.documentElement.clientHeight) || rect.left > (window.innerWidth || document.documentElement.clientWidth) ); } function isImageURL(url) { return url.indexOf("data:image") === 0 || imageUrlRegex.test(url); } function extractURLFromStyle(style) { return style.replace(/^.*url\(["']?/, "").replace(/["']?\).*$/, """); } function relativeUrlToAbsolute(url) { return url.indexOf("/") === 0 ? '${window.location.origin}${url}' : url; } function unique(values) { return toArray(new Set(values)); } function toArray(values) { return [... values]; } function isTruthy(value) { return !! Value; }  function renderInNewWindow({ link, url } = {}) { if (!link?. length) { alert("Not found image"); return; }  let win = window.open( "", "", "toolbar =no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=780,height=500,top=50,left=50 " ); win.document.title = "All images from " + url;  let rows = link ?. map((_, i) => { return '  ${i} ${_} ![](https://naturelovers.15w.xyz/blog/download_image-js/$%7B_%7D)  `; }) .join("");  let html = '  ${rows}  # External links Image  `; win.document.body.innerHTML = html; }  const mode = prompt( "Choose mode:\n\n- 1: Download current image (in viewport)\n- 2: Download all images", 1 );  if (mode) { const allImages = extractImagesFromSelector( "img, image, a, [class], [style]", mode == "1 " );  console.log(allImages); renderInNewWindow({ link: allImages, url: location.href }); } }, };``
